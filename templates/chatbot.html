{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-12">
    
    <!-- Entête du Chatbot -->
    <section class="text-center py-6 bg-gray-900 rounded-xl shadow-xl border border-gray-700">
        <h1 class="text-4xl font-extrabold text-white mb-2">
            AstroIA <i class="fas fa-robot text-accent ml-2"></i>
        </h1>
        <p class="text-lg text-gray-400">
            Posez vos questions sur l'astronomie et l'espace.
        </p>
    </section>

    <!-- Zone de Résultat du Chat -->
    <section class="bg-gray-800 p-6 rounded-xl shadow-inner min-h-[300px] flex flex-col justify-end">
        <div id="chat-history" class="space-y-6">
            
            {% if user_message %}
                <!-- Message Utilisateur -->
                <div class="flex justify-end">
                    <div class="bg-blue-600 text-white p-4 rounded-xl rounded-br-none max-w-lg shadow-md">
                        <p class="font-semibold mb-1">Vous :</p>
                        <p>{{ user_message }}</p>
                    </div>
                </div>

                <!-- Réponse de l'IA -->
                <div class="flex justify-start">
                    <div class="bg-gray-700 text-white p-4 rounded-xl rounded-bl-none max-w-lg shadow-md">
                        <p class="font-semibold mb-2 flex items-center">
                            <i class="fas fa-robot text-accent mr-2"></i> AstroIA :
                        </p>
                        <!-- Le contenu de la réponse de l'IA -->
                        <div class="prose prose-invert max-w-none">
                            <p class="whitespace-pre-line">{{ ai_response_text }}</p>
                        </div>

                        <!-- Affichage des sources (Grounding) -->
                        {% if sources %}
                            <div class="mt-4 pt-2 border-t border-gray-600 text-sm">
                                <p class="font-medium text-accent">Sources (Grounded) :</p>
                                <ul class="list-disc list-inside space-y-1 text-gray-400">
                                    {% for source in sources %}
                                        <li>
                                            <a href="{{ source.uri }}" target="_blank" class="hover:text-white transition duration-150 break-words underline">
                                                {{ source.title | default("Lien sans titre") }}
                                            </a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% else %}
                <!-- Message d'accueil initial -->
                <div class="text-center text-gray-500 py-20">
                    <i class="fas fa-satellite-dish text-6xl mb-4 text-gray-700"></i>
                    <p class="text-xl">Prêt à explorer l'espace ! Tapez votre première question ci-dessous.</p>
                </div>
            {% endif %}
        </div>
    </section>

    <!-- Formulaire de Soumission de la Question -->
    <section>
        <form method="POST" action="{{ url_for('chatbot') }}" class="flex space-x-4">
            <input type="text" 
                   name="message" 
                   placeholder="Tapez votre question sur l'astronomie ici..." 
                   required
                   class="flex-grow p-4 border border-gray-700 rounded-xl bg-gray-900 text-white focus:ring-2 focus:ring-accent focus:border-accent shadow-lg"
            >
            <button type="submit" 
                    class="bg-accent hover:bg-yellow-600 text-gray-900 font-bold py-4 px-6 rounded-xl shadow-lg transition duration-200 flex items-center justify-center">
                <i class="fas fa-paper-plane mr-2"></i> Envoyer
            </button>
        </form>
        <p class="text-xs text-gray-500 mt-2 text-right">L'IA est simulée en mode développement local.</p>
    </section>
</div>
{% endblock content %}